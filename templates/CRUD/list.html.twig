{% extends 'base.html.twig' %}

{% block title %}
	{{ page_title }}
{% endblock %}

{% block body %}
	<div class="container-fluid px-4 py-4">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<h2 class="fw-bold text-dark mb-0">{{ page_title }}</h2>
			<a href="{{ path('app_' ~ entity ~ '_new') }}" class="btn btn-primary px-4 py-2 rounded-pill shadow-sm">
				<i class="bi bi-plus-circle me-2"></i>Create
				{{ entity|capitalize }}
			</a>
		</div>

		<div class="card border-0 shadow-sm rounded-3">
			<div class="card-body p-0">
				<div class="table-responsive">
					<table class="table table-hover align-middle mb-0">
						<thead class="bg-light">
							<tr>
								{% for column in columns %}
									<th class="py-3 px-4 text-secondary fw-semibold text-uppercase small">{{ column|humanize }}</th>
								{% endfor %}
								<th class="py-3 px-4 text-secondary fw-semibold text-uppercase small text-end">Actions</th>
							</tr>
						</thead>
						<tbody>
							{% if items is not empty %}
								{% for item in items %}
									<tr class="border-bottom">
										{% for column in columns %}
											{% if column == 'roles' %}
												<td class="py-3 px-4">
													{% set roles = attribute(item, column) %}
													{% for role in roles %}
														<span class="badge bg-primary bg-opacity-10 text-primary px-3 py-1 rounded-pill me-1 fw-normal">{{ role|replace({'ROLE_': ''})|title }}</span>
													{% endfor %}
												</td>
											{% else %}
												{% set value = getField(item, column) %}
												<td class="py-3 px-4 text-dark">
													{% if value.0 is defined %}
														{% for v in value %}
															<span class="badge bg-info bg-opacity-10 text-info px-3 py-1 rounded-pill me-1 fw-normal">{{ v }}</span>
														{% endfor %}
													{% else %}
														{{ value|e }}
													{% endif %}
												</td>
											{% endif %}
										{% endfor %}

										<td class="py-3 px-4">
											<div class="d-flex gap-2 justify-content-end">
												<a href="{{ path('app_' ~ entity ~ '_show', {id: item.id}) }}" class="btn btn-sm btn-outline-primary rounded-pill px-3">
													<i class="bi bi-eye me-1"></i>View
												</a>
												{% if entity in ['attendance', 'payroll', 'invoice'] and is_granted('ROLE_ADMIN') %}
													<a href="{{ path('app_' ~ entity ~ '_edit', {id: item.id}) }}" class="btn btn-sm btn-outline-warning rounded-pill px-3">
														<i class="bi bi-pencil me-1"></i>Edit
													</a>
													<form method="post" action="{{ path('app_' ~ entity ~ '_delete', {id: item.id}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');" class="d-inline">
														<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ item.id) }}">
														<button class="btn btn-sm btn-outline-danger rounded-pill px-3">
															<i class="bi bi-trash me-1"></i>Delete
														</button>
													</form>
												{% elseif entity not in ['attendance', 'payroll', 'invoice','client'] %}
													<a href="{{ path('app_' ~ entity ~ '_edit', {id: item.id}) }}" class="btn btn-sm btn-outline-warning rounded-pill px-3">
														<i class="bi bi-pencil me-1"></i>Edit
													</a>
													<form method="post" action="{{ path('app_' ~ entity ~ '_delete', {id: item.id}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');" class="d-inline">
														<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ item.id) }}">
														<button class="btn btn-sm btn-outline-danger rounded-pill px-3">
															<i class="bi bi-trash me-1"></i>Delete
														</button>
													</form>
												{% endif %}
											</div>
										</td>
									</tr>
								{% endfor %}
							{% else %}
								<tr>
									<td colspan="{{ columns|length + 1 }}" class="text-center py-5">
										<div class="text-muted">
											<i class="bi bi-inbox fs-1 d-block mb-3"></i>
											<p class="mb-0">No
												{{ entity|capitalize }}
												found</p>
										</div>
									</td>
								</tr>
							{% endif %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
